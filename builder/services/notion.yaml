service:
  name: "notion"
  description: "Notion API - Create and manage pages, databases, and content"
  version: "2022-06-28"

defaults:
  base_url: "https://api.notion.com/v1"
  headers:
    Content-Type: "application/json"
    Notion-Version: "2022-06-28"
  auth:
    type: "bearer"
    header: "Authorization"
    value: "Bearer {{.api_token}}"
  timeout: 30
  content_type: "application/json"

# Global parameters shared across operations
global_params:
  page_size:
    $default: 100
    $type: int
    $description: "Number of results per page"

operations:
  query_database:
    description: "Query a database"
    method: "POST"
    path: "/databases/{{.database_id}}/query"
    
    # Parameters for this operation
    params:
      database_id:
        $required: true
        $type: string
        $description: "Database ID to query"
      filter:
        $optional: true
        $type: object
        $description: "Filter criteria for the database query"
      sorts:
        $optional: true
        $type: array
        $description: "Sort order for results"
      page_size:
        $optional: true
        $type: int
        $description: "Number of results (overrides global default)"
      start_cursor:
        $optional: true
        $type: string
        $description: "Pagination cursor for next page"
    
    # Structured body definition
    body:
      filter:
        $param: filter
      sorts:
        $param: sorts
      page_size:
        $param: page_size
      start_cursor:
        $param: start_cursor
    
    response_type: "json"

  # Keeping other operations with old format for now (will be migrated later)
  get_page:
    description: "Retrieve a page by ID"
    method: "GET"
    path: "/pages/{{.page_id}}"
    response_type: "json"

  create_page:
    description: "Create a new page in a database or as a child of another page"
    method: "POST"
    path: "/pages"
    
    params:
      database_id:
        $optional: true
        $type: string
        $description: "Parent database ID (mutually exclusive with page_id)"
      page_id:
        $optional: true
        $type: string
        $description: "Parent page ID (mutually exclusive with database_id)"
      properties:
        $required: true
        $type: object
        $description: "Page properties (title, etc.)"
      children:
        $optional: true
        $type: array
        $description: "Block children to add to the page"
      icon:
        $optional: true
        $type: object
        $description: "Page icon (emoji or external URL)"
      cover:
        $optional: true
        $type: object
        $description: "Page cover image"
    
    body:
      parent:
        $if:
          $param: database_id
          $exists: true
        $then:
          type: "database_id"
          database_id:
            $param: database_id
        $else:
          type: "page_id"
          page_id:
            $param: page_id
      properties:
        $param: properties
      children:
        $param: children
      icon:
        $param: icon
      cover:
        $param: cover
    
    response_type: "json"

  update_page:
    description: "Update page properties"
    method: "PATCH"
    path: "/pages/{{.page_id}}"
    body: |
      {
        "properties": {{.properties}}
      }
    response_type: "json"

  get_database:
    description: "Retrieve a database by ID"
    method: "GET"
    path: "/databases/{{.database_id}}"
    response_type: "json"

  create_database:
    description: "Create a new database"
    method: "POST"
    path: "/databases"
    body: |
      {
        "parent": {{.parent}},
        "title": {{.title}},
        "properties": {{.properties}}
      }
    response_type: "json"

  get_block_children:
    description: "Retrieve block children"
    method: "GET"
    path: "/blocks/{{.block_id}}/children"
    response_type: "json"

  append_block_children:
    description: "Append block children to a page or block"
    method: "PATCH"
    path: "/blocks/{{.block_id}}/children"
    body: |
      {
        "children": {{.children}}
      }
    response_type: "json"

  search:
    description: "Search pages and databases"
    method: "POST"
    path: "/search"
    body: |
      {
        "query": "{{.query}}",
        "filter": {{.filter}},
        "sort": {{.sort}}
      }
    response_type: "json"

  get_user:
    description: "Retrieve a user by ID"
    method: "GET"
    path: "/users/{{.user_id}}"
    response_type: "json"

  list_users:
    description: "List all users"
    method: "GET"
    path: "/users"
    response_type: "json"
